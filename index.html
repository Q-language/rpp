<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R Preprocessor • rpp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="R Preprocessor">
<meta property="og:description" content="A configurable framework for applying code transformations to R package projects.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rpp</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/plugins.html">Creating plugins</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Q-language/rpp/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rpp" class="section level1">
<div class="page-header"><h1>
<a href="https://rpp.q-lang.org/">rpp</a><a class="anchor" aria-label="anchor" href="#rpp"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>The goal of rpp is to provide a framework for preprocessing R code. Ultimately, this package aims at supporting static type checking for R, among other applications. At this time, dynamic type checking and zero-cost assertions are supported with the help of two other packages, {typed} and {chk}.</p>
<div id="motivation" class="section level2">
<h2>Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>R is a weakly-typed interpreted language: variables can hold objects of any time, there is no explicit compilation stage, and no checks are carried out during run time. This is great for interactive ad-hoc analysis, but can make complex projects more difficult to maintain and debug. In contrast, in strongly-typed languages, the type of each variable is declared beforehand. Adding a static type checking layer to R would make it easier to improve stability in complex projects. With preprocessing, this can be done with no cost at runtime.</p>
</div>
<div id="development-vs-production" class="section level2">
<h2>Development vs. production<a class="anchor" aria-label="anchor" href="#development-vs-production"></a>
</h2>
<p>This package operates on the notion of different source code “modes”:</p>
<ul>
<li>
<strong>Development</strong> (or dev): the code the developer of the package works on</li>
<li>
<strong>Production</strong> (or prod): the code that is run by typical users</li>
</ul>
<p>Expensive checks can be enabled in development mode, while production code is kept lean and fast. In production mode, all checks are completely removed (elided) from the source code. Only production code ends up in version control, this ensures compatibility with existing tooling. Code can be quickly and losslessly converted between development and production modes with <a href="https://rpp.q-lang.org/reference/rpp_to_dev.html"><code>rpp::rpp_to_dev()</code></a> and <a href="https://rpp.q-lang.org/reference/rpp_to_prod.html"><code>rpp::rpp_to_prod()</code></a>.</p>
</div>
<div id="plugins" class="section level2">
<h2>Plugins<a class="anchor" aria-label="anchor" href="#plugins"></a>
</h2>
<p>The rpp package does not implement any code transformations. Rather, it provides the infrastructure for plugins which are responsible for converting development code to production code and back. Currently, two plugins exist (in forks of existing packages in this GitHub organization):</p>
<ul>
<li>{<a href="https://github.com/Q-language/typed" class="external-link">typed</a>} provides dynamic type checking via the <code>typed::rpp_elide_types()</code> plugin</li>
<li>{<a href="https://github.com/Q-language/chk" class="external-link">chk</a>} provides zero-cost assertions via the <a href="https://rdrr.io/pkg/chk/man/rpp_elide_chk_calls.html" class="external-link"><code>chk::rpp_elide_chk_calls()</code></a> plugin</li>
</ul>
<p>Plugins are configured in the <code>DESCRIPTION</code> file.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the development version of rpp and the associated packages from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<pre class="chroma">
<span class="c"># install.packages("devtools")</span>
<span class="nf">devtools</span><span class="nf">::</span><span class="nf"><a href="https://devtools.r-lib.org//reference/remote-reexports.html" class="external-link">install_github</a></span><span class="o">(</span><span class="s">"Q-language/rpp"</span><span class="o">)</span>
<span class="nf">devtools</span><span class="nf">::</span><span class="nf"><a href="https://devtools.r-lib.org//reference/remote-reexports.html" class="external-link">install_github</a></span><span class="o">(</span><span class="s">"Q-language/typed"</span><span class="o">)</span>
<span class="nf">devtools</span><span class="nf">::</span><span class="nf"><a href="https://devtools.r-lib.org//reference/remote-reexports.html" class="external-link">install_github</a></span><span class="o">(</span><span class="s">"Q-language/chk"</span><span class="o">)</span></pre>
<p>Once on <a href="https://CRAN.R-project.org" class="external-link">CRAN</a>, you can also install the released version of rpp with:</p>
<pre class="chroma">
<span class="nf"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="o">(</span><span class="s">"rpp"</span><span class="o">)</span></pre>
</div>
<div id="example" class="section level2">
<h2>Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<pre class="chroma">
<span class="kr"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="o">(</span><span class="nv"><a href="https://github.com/moodymudskipper/typed" class="external-link">typed</a></span><span class="o">)</span>
<span class="c">#&gt; </span>
<span class="c">#&gt; Attaching package: 'typed'</span>
<span class="c">#&gt; The following object is masked from 'devtools_shims':</span>
<span class="c">#&gt; </span>
<span class="c">#&gt;     ?</span>
<span class="c">#&gt; The following object is masked from 'package:utils':</span>
<span class="c">#&gt; </span>
<span class="c">#&gt;     ?</span></pre>
<p>The following function makes use of dynamic type assertions provided by the {typed} package:</p>
<pre class="chroma">
<span class="nv">foo</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/pkg/typed/man/assertion_factories.html" class="external-link">Character</a></span><span class="o">(</span><span class="o">)</span><span class="o">?</span> <span class="kr">function</span><span class="o">(</span><span class="nv">x</span> <span class="o">=</span> <span class="o">?</span><span class="nf"><a href="https://rdrr.io/pkg/typed/man/assertion_factories.html" class="external-link">Character</a></span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
  <span class="nf"><a href="https://rdrr.io/pkg/typed/man/assertion_factories.html" class="external-link">Character</a></span><span class="o">(</span><span class="o">)</span><span class="o">?</span> <span class="nv">out</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="o">(</span><span class="s">"foo:"</span>, <span class="nv">x</span><span class="o">)</span>
  <span class="nv">out</span>
<span class="o">}</span></pre>
<p>This is still valid R code, because {typed} overloads the <code>?</code> operator. The function can only be called with a character vector, other types give an error:</p>
<pre class="chroma">
<span class="nf">foo</span><span class="o">(</span><span class="s">"bar"</span><span class="o">)</span>
<span class="c">#&gt; [1] "foo: bar"</span>
<span class="nf">foo</span><span class="o">(</span><span class="m">1</span><span class="o">)</span>
<span class="c">#&gt; Error: In `foo(1)` at `check_arg(x, Character())`:</span>
<span class="c">#&gt; wrong argument to function, type mismatch</span>
<span class="c">#&gt; `typeof(value)`: <span style="color: #00BB00;">"double"</span>   </span>
<span class="c">#&gt; `expected`:      <span style="color: #00BB00;">"character"</span></span>
<span class="nf">foo</span><span class="o">(</span><span class="nv">mean</span><span class="o">)</span>
<span class="c">#&gt; Error: In `foo(mean)` at `check_arg(x, Character())`:</span>
<span class="c">#&gt; wrong argument to function, type mismatch</span>
<span class="c">#&gt; `typeof(value)`: <span style="color: #00BB00;">"closure"</span>  </span>
<span class="c">#&gt; `expected`:      <span style="color: #00BB00;">"character"</span></span></pre>
<p>These checks are useful, but slow down the code. If this function lives in a package that is configured with the <code>typed::rpp_elide_types()</code> plugin, running <a href="https://rpp.q-lang.org/reference/rpp_to_prod.html"><code>rpp::rpp_to_prod()</code></a> results in the following code:</p>
<pre class="chroma">
<span class="nv">foo</span> <span class="o">&lt;-</span>              <span class="kr">function</span><span class="o">(</span><span class="nv">x</span>               <span class="o">)</span> <span class="o">{</span> <span class="c"># !q foo &lt;- Character()? function(x = ?Character()) {</span>
  <span class="nv">out</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="o">(</span><span class="s">"foo:"</span>, <span class="nv">x</span><span class="o">)</span>                        <span class="c"># !q   Character()? out &lt;- paste("foo:", x)</span>
  <span class="nv">out</span>
<span class="o">}</span></pre>
<p>Running <a href="https://rpp.q-lang.org/reference/rpp_to_dev.html"><code>rpp::rpp_to_dev()</code></a> brings back the original code with the checks. The production version is not particularly pretty, but does the job.</p>
<p>The fork of the {<a href="https://github.com/Q-language/chk" class="external-link">chk</a>} package in this organization is configured for use with rpp. Clone the repository, start an R session, and run <a href="https://rpp.q-lang.org/reference/rpp_to_dev.html"><code>rpp::rpp_to_dev()</code></a> and <a href="https://rpp.q-lang.org/reference/rpp_to_prod.html"><code>rpp::rpp_to_prod()</code></a> to see rpp in action.</p>
</div>
<div id="configure-your-own-project-for-use-with-rpp" class="section level2">
<h2>Configure your own project for use with rpp<a class="anchor" aria-label="anchor" href="#configure-your-own-project-for-use-with-rpp"></a>
</h2>
<p>This example show how to configure your project with rpp and dynamic type checking via {typed}. Note that this requires {typed} to be installed from <a href="https://github.com/Q-language/typed" class="external-link">this organization’s fork</a>. Adapt as necessary for use with other plugins.</p>
<div id="basic-configuration" class="section level3">
<h3>Basic configuration<a class="anchor" aria-label="anchor" href="#basic-configuration"></a>
</h3>
<p>rpp currently works only on projects with a <code>DESCRIPTION</code> file, and operates only on files in the <code>R/</code> directory. Add the following line to <code>DESCRIPTION</code>:</p>
<pre class="chroma">
<span class="nv">Config</span><span class="o">/</span><span class="nv">rpp</span><span class="o">/</span><span class="nv">plugins</span><span class="o">:</span> <span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span><span class="nf">typed</span><span class="nf">::</span><span class="nf">rpp_elide_types</span><span class="o">(</span><span class="o">)</span><span class="o">)</span></pre>
<p>With this configuration, <a href="https://rpp.q-lang.org/reference/rpp_to_dev.html"><code>rpp::rpp_to_dev()</code></a> and <a href="https://rpp.q-lang.org/reference/rpp_to_prod.html"><code>rpp::rpp_to_prod()</code></a> will run the plugin implemented by {typed}.</p>
</div>
<div id="configuring-for-typed" class="section level3">
<h3>Configuring for {typed}<a class="anchor" aria-label="anchor" href="#configuring-for-typed"></a>
</h3>
<p>In the case of {typed}, two more tweaks are necessary:</p>
<ol style="list-style-type: decimal">
<li>The package must be listed in the <code>Suggests</code> section of the <code>DESCRIPTION</code> file.</li>
<li>It should be loaded, at least in development mode, to enable the overload of the <code>?</code> operator.</li>
</ol>
<p>For the latter, you can add the following snippet to your project’s <a href="https://rdrr.io/r/base/ns-hooks.html" class="external-link"><code>.onLoad()</code></a> function:</p>
<pre class="chroma">
<span class="nv">.onLoad</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="nv">libname</span>, <span class="nv">pkgname</span><span class="o">)</span> <span class="o">{</span>
  <span class="c"># Called for the side effect of loading but not attaching the typed package:</span>
  <span class="nf"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="o">(</span><span class="s">"typed"</span>, quietly <span class="o">=</span> <span class="kc">TRUE</span><span class="o">)</span>
<span class="o">}</span></pre>
</div>
<div id="roxygen2-integration" class="section level3">
<h3>{roxygen2} integration<a class="anchor" aria-label="anchor" href="#roxygen2-integration"></a>
</h3>
<p>A project can be automated to change to production mode when <a href="https://devtools.r-lib.org//reference/document.html" class="external-link"><code>devtools::document()</code></a> is run. Add the <a href="https://rpp.q-lang.org/reference/roclets.html"><code>rpp::rpp_prod_roclet()</code></a> to the list of roclets:</p>
<pre class="chroma">
<span class="nv">Roxygen</span><span class="o">:</span> <span class="nf"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="o">(</span>markdown <span class="o">=</span> <span class="kc">TRUE</span>, roclets <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span><span class="s">"collate"</span>, <span class="s">"namespace"</span>, <span class="s">"rd"</span>, <span class="s">"rpp::rpp_prod_roclet"</span><span class="o">)</span><span class="o">)</span></pre>
<p>RStudio users can also edit the <code>.Rproj</code> file to convert to prod when Ctrl+Shift+D is pressed:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1"></a>PackageRoxygenize: rd,collate,namespace,rpp::rpp_prod_roclet</span></code></pre></div>
<p>With this configuration, running <a href="https://devtools.r-lib.org//reference/document.html" class="external-link"><code>devtools::document()</code></a> includes the effect of calling <a href="https://rpp.q-lang.org/reference/rpp_to_prod.html"><code>rpp::rpp_to_prod()</code></a>.</p>
</div>
</div>
<div id="further-reading" class="section level2">
<h2>Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>The creation of a new plugin and the integration with roxygen2 is described in <a href="https://rpp.q-lang.org/articles/plugins.html"><code>vignette("plugins", package = "rpp")</code></a>.</p>
<hr>
</div>
<div id="code-of-conduct" class="section level2">
<h2>Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the rpp project is released with a <a href="https://rpp.q-lang.org/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/Q-language/rpp/">https://​github.com/​Q-language/​rpp/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/Q-language/rpp/issues">https://​github.com/​Q-language/​rpp/​issues</a>
</li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://krlmlr.info">Kirill Müller</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-1416-3412" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More on authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
